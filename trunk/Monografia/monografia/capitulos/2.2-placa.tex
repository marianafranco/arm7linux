 % A Placa Experimental Evaluator-7T
\section{A Placa Experimental Evaluator-7T} \label{sec:conceitos_placa}
\index{conceitos!placa}

O principal elemento de hardware deste projeto é a placa experimental ARM Evaluator-7T, baseada no processador ARM7TDMI, um processador RISC de 32 bits capaz de executar o conjunto de instruções denominado Thumb.

Os principais elementos presentes na arquitetura da placa Evaluator-7T são os seguintes:

\begin{itemize}

\item Microcontrolador Samsung KS32C50100

\item 512kB EPROM flash

\item 512kB RAM estática (SRAM)

\item Dois conectores RS232 de 9 pinos tipo D

\item Botões de reset e de interrupção

\item Quatro LEDs programáveis pelo usuário e um display de 7 segmentos

\item Entrada de usuário por um interruptor DIP com 4 elementos

\item Conector Multi-ICE

\item Clock de 10MHz (o processador usa-o para gerar um clock de 50MHz)

\item Regulador de tensão de 3.3V

\end{itemize}

A figura \ref{arch_e7t} mostra a organização desses elementos na placa experimental.

%Não esquecer de colocar a fonte!
\begin{figure}[!ht]
\centering 
\includegraphics[height=12cm]{figuras/board_arch.png}
\caption{Arquitetura da placa Evaluator-7T. \cite{E7TUserGuide} \label{arch_e7t}}
\end{figure}


Com relação à memória flash da placa, ela vem de fábrica com o bootstrap loader da placa e programa monitor de debug. O restante dela pode ser usado para os programas de usuário. A tabela \ref{table:mapamemflash}  mostra a faixa de endereços de cada região da memória.

% a tabela nao esta aparecendo no lugar certo (logo após o parágrafo acima)
\begin{table}[!ht]
\caption{Mapa da memória flash}
\centering
\begin{tabular}{| c | c |}
\hline  \textbf{Faixa de endereço} & \textbf{Descrição}  \\ 
\hline  0x01800000 a 0x01806FFF & Bootstrap loader  \\ 
\hline  0x01807000 a 0x01807FFF & Teste de produção  \\ 
\hline  0x01808000 a 0x0180FFFF & Reservado  \\ 
\hline  0x01810000 a 0x0181FFFF & Angel  \\ 
\hline  0x01820000 a 0x0187FFFF & Disponível para outros programas e dados  \\ 
\hline 
\end{tabular}
\label{table:mapamemflash}
\end{table}

Já em relação às duas portas seriais presentes na placa, cada uma tem usos específicos. A primeira, chamada DEBUG, é usada pelo monitor de debug ou pelo programa bootstrap presente na placa. Ela está conectada ao UART1 do microcontrolador. A segunda, chamada USER, é de uso genérico e está disponível para uso em programas. Ela está conectada ao UART0 do microcontrolador.

%BSL
\subsection{Bootstrap Loader}

Como mencionado anteriormente, a memória flash da placa contém uma região reservada para os programas Bootstrap Loader (BSL) e o programa monitor de debug chamado Angel.

O BSL é o primeiro programa a ser executado pelo microcontrolador quando esta é ligada ou reiniciada. Suas principais funções são:

\begin{itemize}

\item Fazer a conexão com o computador através da porta serial e uma aplicação de terminal, como o HyperTerminal do Windows

\item Prover a infraestrutura necessária à configuração da placa

\item Prover ajuda ao usuário

\item Gerenciar imagens de memória como um conjunto de módulos executáveis

\item Carregar aplicações na SRAM e executá-las

\end{itemize}

\subsubsection{Comunicação com o PC}

Neste projeto, foi usado um PC com o sistema operacional Windows XP para fazer a comunicação com o BSL da placa Evaluator-7T. Essa comunicação é feita através de um cabo serial conectado à porta COM1 (Debug) da placa. Estando a placa conectada à porta serial e energizada com uma fonte de alimentação própria, pode-se estabelecer a comunicação com o BSL por meio do programa HyperTerminal. As configurações de comunicação utilizadas foram:

\begin{itemize}

\item Velocidade de transferência de 9600 bauds

\item 8 bits de dados

\item Sem paridade

\item 1 bit de parada

\item Sem controle de fluxo

\end{itemize}

Após a configuração adequada da placa, é preciso reiniciá-la, pressionando o botão SW1 (SYS RESET). Então, a placa envia a seguinte mensagem ao terminal:

\begin{lstlisting}
ARM Evaluator7T Boot Monitor Release 1.01
Press ENTER within 2 seconds to stop autoboot
\end{lstlisting}

Pressionando a tecla \emph{Enter} em até dois segundos da exibição da mensagem acima, nenhum outro módulo da memória é executado, além do BSL. Desse momento em diante, o BSL exibe seu editor de linha de comando, a partir do qual é possível gerenciar, embarcar e executar programas na placa. A figura \ref{bsl_ht} mostra o HyperTerminal com o BSL carregado e aguardando um comando.

\begin{figure}[!ht]
\centering 
\includegraphics[height=8cm]{figuras/bsl_ht.png}
\caption{Editor de linha de comando do BSL via HyperTerminal \label{bsl_ht}}
\end{figure}

\subsubsection{Carregando e executando programas via BSL}

Após a compilação de um projeto, o ambiente de desenvolvimento cria uma imagem de memória em formato binário (extensão \emph{.bin}). Essa imagem, no entanto, não pode ser carregada diretamente na placa através do BSL. Ela deve ser convertida para o formato UUE (Unix-to-Unix Encoding), o qual é uma representação em arquivo texto do arquivo binário original. Neste projeto, foi utilizado para essa conversão o programa \emph{uuencode} fornecido no CD-ROM que acompanha a placa Evaluator-7T.

Uma vez convertido o arquivo para o formato adequado, ele está pronto para ser enviado à Evaluator-7T. Continua...

%Angel
\subsection{Angel Debug Monitor}

O monitor de debug Angel é fornecido conjuntamente com diversas placas da ARM e suas parceiras. Suas principais funcionalidades são:

\begin{itemize}

\item Função de depuração de código, incluindo inspeção de memória, download e execução de imagens de memória, uso de breakpoints e execução passo-a-passo

\item Inicialização da CPU e da placa e tratamento básico de exceções

\item Uma biblioteca ANSI C completa, com uso de semihosting para prover serviços do computador host que não estão disponíveis na placa

\end{itemize}

Há duas maneiras pelas quais o Angel se comunica com o ambiente de desenvolvimento de software.

A primeira é através da biblioteca de interfaces chamada "Remote\_A". Por ela, os depuradores se comunicam com um alvo do Angel quando fazem depuração ou execução de código.

A segunda é por meio de interrupções de software (SWI). O código do programa faz uma SWI para solicitar serviços dos Angel diretamente ou através da biblioteca C do toolkit.
